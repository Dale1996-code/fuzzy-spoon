import React, { useState, useEffect } from ‘react’;
import { ChevronRight, Users, Package, AlertTriangle, ClipboardCheck, CheckCircle2 } from ‘lucide-react’;

export default function ShiftControlDashboard() {
const [currentView, setCurrentView] = useState(‘input’);
const [shiftData, setShiftData] = useState({
date: new Date().toISOString().split(‘T’)[0],
groceryStockers: 4,
produceWorker: 1,
meatWorker: 1,
frozenDairyWorker: 1,
deliBakeryWorkers: 2,
palletCount: 12,
problemAreas: []
});

const [safetyChecklist, setSafetyChecklist] = useState({});

const problemAreaOptions = [
‘Deli cooking prep behind’,
‘Produce not maxed/full’,
‘Meat not maxed/full’,
‘Frozen/Dairy daily tasks’,
‘Water/Topstock issues’,
‘Grocery freight behind pace’
];

const safetyCategories = [
{
title: ‘General Safety’,
items: [
‘Floors dry, no spills’,
‘Keep trash off floor’,
‘Guard spills until cleaned’,
‘No blocked/narrow walkways’,
‘Emergency exits clear’,
‘Parking lot lighting checked’
]
},
{
title: ‘Stocking & Freight’,
items: [
‘Aisles clear’,
‘No standing on pallets’,
‘Freight staged safely’,
‘Lockup cases clean/secure’
]
},
{
title: ‘Ladders & Fall Prevention’,
items: [
‘No standing on diamond plate rails’,
‘No standing on L carts’,
‘Only use topstock cart steps’,
‘All topstock sections checked’
]
},
{
title: ‘Cutting Safety’,
items: [
‘Only approved box cutters’,
‘Blades retracted while walking’
]
},
{
title: ‘Power Equipment’,
items: [
‘Yellow vests worn’,
‘Keys turned off when not in use’,
‘Equipment parked in designated areas’
]
},
{
title: ‘Doors & Emergency’,
items: [
‘All doors locked’,
‘Emergency exits unblocked’,
‘Fire extinguishers/eyewash accessible’,
‘Associates know rally points’,
‘A.D.D. protocol reviewed’,
‘Emergency numbers posted’
]
},
{
title: ‘Situational Awareness’,
items: [
‘Report suspicious activity’,
‘Monitor unattended items/crowds’,
‘Rotate parking locations’,
‘Offer escorts after dark’
]
},
{
title: ‘Conflict De-escalation’,
items: [
‘Stay calm and respectful’,
‘Avoid defensive language’,
‘Show empathy, listen actively’,
‘Call for assistance if needed’
]
}
];

useEffect(() => {
const saved = localStorage.getItem(‘shiftControlData’);
if (saved) {
setShiftData(JSON.parse(saved));
}
}, []);

const saveData = (data) => {
setShiftData(data);
localStorage.setItem(‘shiftControlData’, JSON.stringify(data));
};

const toggleProblemArea = (area) => {
const newAreas = shiftData.problemAreas.includes(area)
? shiftData.problemAreas.filter(a => a !== area)
: […shiftData.problemAreas, area];
saveData({ …shiftData, problemAreas: newAreas });
};

const toggleSafetyItem = (category, item) => {
const key = `${category}-${item}`;
setSafetyChecklist(prev => ({
…prev,
[key]: !prev[key]
}));
};

const getFreightStrategy = () => {
const totalAssociates = shiftData.groceryStockers;
const palletsPerPerson = shiftData.palletCount / totalAssociates;

```
if (shiftData.palletCount >= 15) {
  return {
    status: 'HEAVY LOAD',
    strategy: 'All hands on freight first 2 hours. Prioritize high-velocity aisles. Consider pulling 1 fresh associate for backup if critical.',
    pace: `${palletsPerPerson.toFixed(1)} pallets/person. Target: 1 pallet/45min.`
  };
} else if (shiftData.palletCount >= 10) {
  return {
    status: 'MODERATE LOAD',
    strategy: 'Standard freight flow. Focus grocery team on freight while fresh maintains departments. Check progress at 2-hour mark.',
    pace: `${palletsPerPerson.toFixed(1)} pallets/person. Target: 1 pallet/hour.`
  };
} else {
  return {
    status: 'LIGHT LOAD',
    strategy: 'Freight completion + deep zoning. Plan for topstock work and endcap maintenance after freight clear.',
    pace: `${palletsPerPerson.toFixed(1)} pallets/person. Should clear by mid-shift.`
  };
}
```

};

const getFreshWalkPriorities = () => {
const priorities = [];

```
if (shiftData.problemAreas.includes('Deli cooking prep behind')) {
  priorities.push({
    area: 'DELI/BAKERY',
    priority: 'HIGH',
    action: 'Check hot case levels. Verify cook schedule on track. Ensure rotation happening.'
  });
} else {
  priorities.push({
    area: 'DELI/BAKERY',
    priority: 'STANDARD',
    action: 'Quick hot case check. Confirm production schedule.'
  });
}

if (shiftData.problemAreas.includes('Produce not maxed/full') || 
    shiftData.problemAreas.includes('Meat not maxed/full')) {
  priorities.push({
    area: 'PRODUCE/MEAT',
    priority: 'HIGH',
    action: 'Full department audit. Check dates, rotation, culling. Fill all holes. Verify temp logs.'
  });
} else {
  priorities.push({
    area: 'PRODUCE/MEAT',
    priority: 'STANDARD',
    action: 'Visual sweep. Check key items (bananas, berries, ground beef, chicken).'
  });
}

if (shiftData.problemAreas.includes('Frozen/Dairy daily tasks')) {
  priorities.push({
    area: 'FROZEN/DAIRY',
    priority: 'HIGH',
    action: 'Verify daily task completion: milk rotation, yogurt dates, frozen door temps, ice cream leveling.'
  });
} else {
  priorities.push({
    area: 'FROZEN/DAIRY',
    priority: 'STANDARD',
    action: 'Quick check milk stock and frozen door conditions.'
  });
}

return priorities;
```

};

const totalAssociates = shiftData.groceryStockers + shiftData.produceWorker +
shiftData.meatWorker + shiftData.frozenDairyWorker +
shiftData.deliBakeryWorkers;

if (currentView === ‘input’) {
return (
<div className="min-h-screen bg-gray-900 text-white p-4">
<div className="max-w-2xl mx-auto">
<h1 className="text-2xl font-bold mb-6 text-blue-400">Shift Control Dashboard</h1>

```
      <div className="bg-gray-800 rounded-lg p-4 mb-4">
        <label className="block text-sm font-medium mb-2">Date</label>
        <input
          type="date"
          value={shiftData.date}
          onChange={(e) => saveData({ ...shiftData, date: e.target.value })}
          className="w-full bg-gray-700 rounded px-3 py-2 text-white"
        />
      </div>

      <div className="bg-gray-800 rounded-lg p-4 mb-4">
        <h2 className="text-lg font-semibold mb-3 flex items-center">
          <Users className="mr-2" size={20} />
          Team Count
        </h2>
        
        <div className="space-y-3">
          <div>
            <label className="block text-sm mb-1">Grocery Stockers</label>
            <input
              type="number"
              value={shiftData.groceryStockers}
              onChange={(e) => saveData({ ...shiftData, groceryStockers: parseInt(e.target.value) || 0 })}
              className="w-full bg-gray-700 rounded px-3 py-2"
              min="0"
            />
          </div>
          
          <div className="grid grid-cols-2 gap-3">
            <div>
              <label className="block text-sm mb-1">Produce</label>
              <input
                type="number"
                value={shiftData.produceWorker}
                onChange={(e) => saveData({ ...shiftData, produceWorker: parseInt(e.target.value) || 0 })}
                className="w-full bg-gray-700 rounded px-3 py-2"
                min="0"
              />
            </div>
            <div>
              <label className="block text-sm mb-1">Meat</label>
              <input
                type="number"
                value={shiftData.meatWorker}
                onChange={(e) => saveData({ ...shiftData, meatWorker: parseInt(e.target.value) || 0 })}
                className="w-full bg-gray-700 rounded px-3 py-2"
                min="0"
              />
            </div>
          </div>
          
          <div className="grid grid-cols-2 gap-3">
            <div>
              <label className="block text-sm mb-1">Frozen/Dairy</label>
              <input
                type="number"
                value={shiftData.frozenDairyWorker}
                onChange={(e) => saveData({ ...shiftData, frozenDairyWorker: parseInt(e.target.value) || 0 })}
                className="w-full bg-gray-700 rounded px-3 py-2"
                min="0"
              />
            </div>
            <div>
              <label className="block text-sm mb-1">Deli/Bakery</label>
              <input
                type="number"
                value={shiftData.deliBakeryWorkers}
                onChange={(e) => saveData({ ...shiftData, deliBakeryWorkers: parseInt(e.target.value) || 0 })}
                className="w-full bg-gray-700 rounded px-3 py-2"
                min="0"
              />
            </div>
          </div>
          
          <div className="text-sm text-blue-400 pt-2 border-t border-gray-700">
            Total Associates: {totalAssociates}
          </div>
        </div>
      </div>

      <div className="bg-gray-800 rounded-lg p-4 mb-4">
        <h2 className="text-lg font-semibold mb-3 flex items-center">
          <Package className="mr-2" size={20} />
          Freight Load
        </h2>
        <div>
          <label className="block text-sm mb-1">Pallet Count</label>
          <input
            type="number"
            value={shiftData.palletCount}
            onChange={(e) => saveData({ ...shiftData, palletCount: parseInt(e.target.value) || 0 })}
            className="w-full bg-gray-700 rounded px-3 py-2"
            min="0"
          />
        </div>
      </div>

      <div className="bg-gray-800 rounded-lg p-4 mb-6">
        <h2 className="text-lg font-semibold mb-3 flex items-center">
          <AlertTriangle className="mr-2" size={20} />
          Problem Areas
        </h2>
        <div className="space-y-2">
          {problemAreaOptions.map((area) => (
            <button
              key={area}
              onClick={() => toggleProblemArea(area)}
              className={`w-full text-left px-4 py-3 rounded transition-colors ${
                shiftData.problemAreas.includes(area)
                  ? 'bg-red-600 text-white'
                  : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
              }`}
            >
              {area}
            </button>
          ))}
        </div>
      </div>

      <button
        onClick={() => setCurrentView('dashboard')}
        className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 rounded-lg flex items-center justify-center"
      >
        Generate Shift Plan
        <ChevronRight className="ml-2" size={20} />
      </button>
    </div>
  </div>
);
```

}

if (currentView === ‘dashboard’) {
const freightStrategy = getFreightStrategy();
const freshPriorities = getFreshWalkPriorities();

```
return (
  <div className="min-h-screen bg-gray-900 text-white p-4">
    <div className="max-w-2xl mx-auto">
      <div className="flex items-center justify-between mb-6">
        <h1 className="text-2xl font-bold text-blue-400">Shift Plan</h1>
        <button
          onClick={() => setCurrentView('input')}
          className="text-sm bg-gray-700 px-4 py-2 rounded hover:bg-gray-600"
        >
          Edit
        </button>
      </div>

      <div className="bg-gray-800 rounded-lg p-4 mb-4 border-l-4 border-blue-500">
        <div className="text-sm text-gray-400 mb-1">{shiftData.date}</div>
        <div className="text-lg font-semibold">{totalAssociates} Associates · {shiftData.palletCount} Pallets</div>
      </div>

      <div className="bg-gray-800 rounded-lg p-4 mb-4">
        <h2 className="text-lg font-semibold mb-3 text-yellow-400">Freight Strategy</h2>
        <div className="mb-2">
          <span className={`inline-block px-3 py-1 rounded text-sm font-bold ${
            freightStrategy.status === 'HEAVY LOAD' ? 'bg-red-600' :
            freightStrategy.status === 'MODERATE LOAD' ? 'bg-yellow-600' :
            'bg-green-600'
          }`}>
            {freightStrategy.status}
          </span>
        </div>
        <p className="text-gray-300 mb-2">{freightStrategy.strategy}</p>
        <div className="bg-gray-700 rounded p-3 text-sm">
          <strong>Pace Target:</strong> {freightStrategy.pace}
        </div>
      </div>

      <div className="bg-gray-800 rounded-lg p-4 mb-4">
        <h2 className="text-lg font-semibold mb-3 text-green-400">Fresh Walk Priorities</h2>
        <div className="space-y-3">
          {freshPriorities.map((priority, idx) => (
            <div key={idx} className="bg-gray-700 rounded p-3">
              <div className="flex items-center justify-between mb-2">
                <span className="font-semibold">{priority.area}</span>
                <span className={`text-xs px-2 py-1 rounded ${
                  priority.priority === 'HIGH' ? 'bg-red-600' : 'bg-blue-600'
                }`}>
                  {priority.priority}
                </span>
              </div>
              <p className="text-sm text-gray-300">{priority.action}</p>
            </div>
          ))}
        </div>
      </div>

      <button
        onClick={() => setCurrentView('safety')}
        className="w-full bg-orange-600 hover:bg-orange-700 text-white font-semibold py-4 rounded-lg flex items-center justify-center mb-4"
      >
        <ClipboardCheck className="mr-2" size={20} />
        Start Safety Walk
      </button>

      <div className="bg-gray-800 rounded-lg p-4">
        <h2 className="text-lg font-semibold mb-3 text-red-400">Active Problem Areas</h2>
        {shiftData.problemAreas.length > 0 ? (
          <ul className="space-y-2">
            {shiftData.problemAreas.map((area, idx) => (
              <li key={idx} className="flex items-start">
                <AlertTriangle className="mr-2 mt-1 flex-shrink-0 text-red-400" size={16} />
                <span className="text-gray-300">{area}</span>
              </li>
            ))}
          </ul>
        ) : (
          <p className="text-gray-400 italic">No problem areas flagged</p>
        )}
      </div>
    </div>
  </div>
);
```

}

if (currentView === ‘safety’) {
const completedCount = Object.values(safetyChecklist).filter(Boolean).length;
const totalItems = safetyCategories.reduce((sum, cat) => sum + cat.items.length, 0);
const progress = totalItems > 0 ? Math.round((completedCount / totalItems) * 100) : 0;

```
return (
  <div className="min-h-screen bg-gray-900 text-white p-4">
    <div className="max-w-2xl mx-auto">
      <div className="flex items-center justify-between mb-4">
        <h1 className="text-2xl font-bold text-orange-400">Safety Walk</h1>
        <button
          onClick={() => setCurrentView('dashboard')}
          className="text-sm bg-gray-700 px-4 py-2 rounded hover:bg-gray-600"
        >
          Back
        </button>
      </div>

      <div className="bg-gray-800 rounded-lg p-4 mb-4">
        <div className="flex items-center justify-between mb-2">
          <span className="text-sm font-medium">Progress</span>
          <span className="text-sm text-gray-400">{completedCount} / {totalItems}</span>
        </div>
        <div className="w-full bg-gray-700 rounded-full h-3">
          <div
            className="bg-green-500 h-3 rounded-full transition-all"
            style={{ width: `${progress}%` }}
          />
        </div>
      </div>

      <div className="space-y-4">
        {safetyCategories.map((category, catIdx) => (
          <div key={catIdx} className="bg-gray-800 rounded-lg p-4">
            <h3 className="font-semibold mb-3 text-orange-300">{category.title}</h3>
            <div className="space-y-2">
              {category.items.map((item, itemIdx) => {
                const key = `${category.title}-${item}`;
                const isChecked = safetyChecklist[key];
                
                return (
                  <button
                    key={itemIdx}
                    onClick={() => toggleSafetyItem(category.title, item)}
                    className={`w-full text-left px-3 py-3 rounded flex items-start transition-colors ${
                      isChecked
                        ? 'bg-green-700 text-white'
                        : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                    }`}
                  >
                    <CheckCircle2
                      className={`mr-3 mt-0.5 flex-shrink-0 ${
                        isChecked ? 'text-green-300' : 'text-gray-500'
                      }`}
                      size={20}
                    />
                    <span className="text-sm">{item}</span>
                  </button>
                );
              })}
            </div>
          </div>
        ))}
      </div>

      {progress === 100 && (
        <div className="mt-6 bg-green-600 rounded-lg p-4 text-center">
          <CheckCircle2 className="mx-auto mb-2" size={40} />
          <p className="font-semibold text-lg">Safety Walk Complete!</p>
        </div>
      )}
    </div>
  </div>
);
```

}
}